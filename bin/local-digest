#!/bin/zsh

cd "${0%/*}/.."

set -eo pipefail

if [[ -f last_sync ]]; then
  LAST_SYNC=$(<last_sync)
else
  LAST_SYNC=$(date -u -v-2w +"%Y-%m-%dT%H:%M:%SZ")
fi

TARGET_USER=$TARGET_USER

poetry run todoist-digest \
  --last-synced $LAST_SYNC \
  --target-user $TARGET_USER \
  --target-project $TARGET_PROJECT \
  --email-auth $EMAIL_AUTH \
  --email-to $EMAIL_TO

date -u +"%Y-%m-%dT%H:%M:%SZ" > last_sync
